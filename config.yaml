# Binance Futures Analysis System Configuration

# Application Configuration
app:
  name: "Binance Futures Analysis"
  version: "1.0.0"
  environment: "development"  # development, staging, production
  timezone: "UTC"

# Server Configuration (for monitoring API)
server:
  host: "0.0.0.0"
  port: 8080
  read_timeout: 30s
  write_timeout: 30s

# Binance API Configuration
binance:
  api_url: "https://fapi.binance.com"
  api_key: ""  # Set via environment variable: CA_BINANCE_API_KEY
  api_secret: ""  # Set via environment variable: CA_BINANCE_API_SECRET
  rate_limit:
    requests_per_minute: 1200
    weight_per_minute: 2400
  timeout: 10s

# Data Collection Configuration
collection:
  enabled: true
  interval: "0 0 * * * *"  # Cron format: every hour at minute 0
  pair_filter:
    quote_asset: "USDT"  # Only USDT-margined futures
    exclude_pairs: []  # Pairs to exclude, e.g., ["BTCDOMUSDT"]
  retry:
    max_attempts: 3
    delay: 5s
    backoff_multiplier: 2

# Database Configuration
database:
  type: "mysql"  # mysql or redis

  mysql:
    host: "localhost"  # Set via environment variable: CA_DATABASE_MYSQL_HOST
    port: 3306
    database: "futures_analysis"
    username: "root"  # Set via environment variable: CA_DATABASE_MYSQL_USERNAME
    password: "123456"  # Set via environment variable: CA_DATABASE_MYSQL_PASSWORD
    charset: "utf8mb4"
    parse_time: true
    max_open_conns: 25
    max_idle_conns: 5
    conn_max_lifetime: 5m
    conn_max_idle_time: 10m
    slow_query_threshold: 200ms

  redis:
    host: "localhost"  # Set via environment variable: CA_DATABASE_REDIS_HOST
    port: 6379
    password: "Quantweb3"  # Set via environment variable: CA_DATABASE_REDIS_PASSWORD
    db: 0
    pool_size: 10
    min_idle_conns: 5
    max_retries: 3
    dial_timeout: 5s
    read_timeout: 3s
    write_timeout: 3s

# Strategy Configuration
strategies:
  # Minority Strategy: Follow the minority
  minority:
    enabled: true
    name: "Minority Follower"
    min_ratio_difference: 60.0  # 60:40 ratio or more (more realistic)
    confirmation_hours: 2  # Require 2-hour confirmation
    generate_long_when_short_ratio_above: 60.0  # If >60% short, go long
    generate_short_when_long_ratio_above: 60.0  # If >60% long, go short
    tracking_hours: 24  # Track for 24 hours after signal
    profit_target_pct: 5.0  # Consider 5% move as target
    stop_loss_pct: 2.0  # Consider 2% adverse move as stop

  # Whale Strategy: Analyze position size vs account count
  whale:
    enabled: true
    name: "Whale Position Analysis"
    min_ratio_difference: 55.0  # Account ratio difference (relaxed from 60.0)
    whale_position_threshold: 52.0  # Whale position must be >=52% (relaxed from 55.0)
    confirmation_hours: 2
    min_divergence: 12.0  # Minimum divergence between ratios (relaxed from 15.0)
    tracking_hours: 24
    profit_target_pct: 5.0
    stop_loss_pct: 2.0

  # Smart Money Strategy: Liquidity Grabs & SFP
  smart_money:
    enabled: true
    name: "Smart Money (Liquidity Grab)"
    min_long_account_ratio: 62.0      # ~1.63 ratio (relaxed from 65.0 to generate more signals)
    lookback_period: 24               # Look back 24 candles for High
    kline_interval: "1h"              # 1-hour candles
    confirmation_hours: 1
    tracking_hours: 24
    profit_target_pct: 6.0            # Higher reward for SFP
    stop_loss_pct: 1.5                # Tight stop above wick

  # Global strategy settings
  global:
    min_volume_24h: 1000000  # Minimum 24h volume in USDT
    max_concurrent_signals_per_pair: 3
    signal_cooldown_hours: 6  # Wait 6 hours before new signal on same pair

# Statistics Configuration
statistics:
  calculation_interval: "0 0 */6 * * *"  # Every 6 hours
  periods:
    - "24h"
    - "7d"
    - "30d"
    - "all"
  percentiles: [25, 50, 75, 90, 95]
  monitoring:
    enabled: true
    win_rate_change_threshold: 15.0           # ç™¾åˆ†ç‚¹å˜åŒ–
    profit_ratio_change_threshold: 15.0       # ç™¾åˆ†ç‚¹å˜åŒ–
    avg_profit_change_threshold: 20.0         # ç™¾åˆ†æ¯”å˜åŒ–
    avg_loss_change_threshold: 20.0           # ç™¾åˆ†æ¯”å˜åŒ–
    profit_factor_change_threshold: 25.0      # ç™¾åˆ†æ¯”å˜åŒ–
    signal_count_change_threshold: 50.0       # ç™¾åˆ†æ¯”å˜åŒ–

# Notification Configuration
notifications:
  # Telegram
  telegram:
    enabled: false
    bot_token: ""  # Set via environment variable: CA_NOTIFICATIONS_TELEGRAM_BOT_TOKEN
    chat_ids: []  # Set via environment variable: CA_NOTIFICATIONS_TELEGRAM_CHAT_IDS
    events:
      - "signal_generated"
      - "signal_confirmed"
      - "signal_outcome"
      - "system_error"
    template: |
      ğŸš¨ *{{.Type}}*

      Symbol: {{.Symbol}}
      Direction: {{.Direction}}
      Strategy: {{.Strategy}}
      Price: {{.Price}}

      ğŸ“Š Ratios:
      Long/Short (Accounts): {{.LongAccountRatio}}/{{.ShortAccountRatio}}
      Long/Short (Position): {{.LongPositionRatio}}/{{.ShortPositionRatio}}

      {{.Reason}}

  # Email
  email:
    enabled: false
    smtp_host: "smtp.gmail.com"
    smtp_port: 587
    username: ""  # Set via environment variable: CA_NOTIFICATIONS_EMAIL_USERNAME
    password: ""  # Set via environment variable: CA_NOTIFICATIONS_EMAIL_PASSWORD
    from: ""
    to: []
    events:
      - "signal_confirmed"
      - "system_error"

  # Webhook
  webhook:
    enabled: false
    url: ""  # Set via environment variable: CA_NOTIFICATIONS_WEBHOOK_URL
    method: "POST"
    headers:
      Content-Type: "application/json"
    timeout: 10s
    events:
      - "signal_generated"
      - "signal_confirmed"

  # Console (for development)
  console:
    enabled: true
    events:
      - "signal_generated"
      - "signal_confirmed"
      - "signal_invalidated"
      - "signal_outcome"

# Logging Configuration
logging:
  level: "info"  # debug, info, warn, error
  format: "json"  # json or console
  output:
    - "stdout"
    - "file"
  file:
    path: "logs/app.log"
    max_size: 100  # MB
    max_backups: 10
    max_age: 30  # days
    compress: true

# Monitoring Configuration
monitoring:
  enabled: true
  metrics:
    enabled: true
    port: 9090
    path: "/metrics"
  health_check:
    enabled: true
    path: "/health"

# Feature Flags
features:
  backtest_mode: false
  dry_run: false  # If true, collect data but don't send notifications
  debug_signals: true  # Log detailed signal calculation info
